var VGCalendar=function(){"use strict";function e(e,t,n,o){return new(n||(n=Promise))(function(r,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}c((o=o.apply(e,t||[])).next())})}function t(){try{const e="__test";return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(e){return!1}}function n(n){return e(this,void 0,void 0,function*(){const e=function(e){if(t()){const t=sessionStorage.getItem(e);if(t)try{const e=JSON.parse(t);if(!e.exp||e.exp>Date.now())return e.value}catch(e){return null}}return null}(n);if(e)return e;const o=yield fetch(n),r=yield o.json();return function(e,n,o=3e5){if(t()){const t={value:n,exp:Date.now()+o};try{sessionStorage.setItem(e,JSON.stringify(t))}catch(e){}}}(n,r,3e5),r})}function o(e,t){e.setAttribute("aria-pressed",t?"true":"false")}function r(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function s(e,t){(function(){const e=document.createElement("input");e.setAttribute("type","date");const t="not-a-date";return e.setAttribute("value",t),e.value!==t})()&&(e.startDate.type="date",e.endDate.type="date"),e.typeButtons.forEach(n=>{n.addEventListener("click",()=>{e.typeButtons.forEach(e=>o(e,!1)),n.classList.add("active"),o(n,!0),t()}),n.addEventListener("keydown",t=>{if("Enter"===t.key||" "===t.key)t.preventDefault(),n.click();else if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault();const o=Array.from(e.typeButtons),r=o.indexOf(n);(o[r+1]||o[0]).focus()}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault();const o=Array.from(e.typeButtons),r=o.indexOf(n);(o[r-1]||o[o.length-1]).focus()}})});const n=function(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}(t,300);[e.startDate,e.endDate,e.searchBar,e.monthFilter,e.townFilter].forEach(e=>{e.addEventListener("change",n),e.addEventListener("input",n)}),e.resetBtn.addEventListener("click",()=>{e.startDate.value="",e.endDate.value="",e.searchBar.value="",e.monthFilter.value="",e.townFilter.value="",e.typeButtons.forEach(e=>{e.classList.remove("active"),o(e,!1)}),t()})}"function"==typeof SuppressedError&&SuppressedError;let a=null;class i{constructor(e){this.currentPage=1,this.totalPages=1,this.config=e,document.addEventListener("DOMContentLoaded",()=>this.init())}init(){var e,t;s({startDate:document.getElementById("start-date"),endDate:document.getElementById("end-date"),searchBar:document.getElementById("search-bar"),monthFilter:document.getElementById("month-filter"),townFilter:document.getElementById("town-filter"),typeButtons:document.querySelectorAll("#post-type-filters .post-type-filter"),resetBtn:document.getElementById("reset-filters")},()=>{this.currentPage=1,this.load()}),null===(e=document.getElementById("prev-page"))||void 0===e||e.addEventListener("click",()=>{this.currentPage>1&&(this.currentPage--,this.load())}),null===(e=document.getElementById("prev-page"))||void 0===e||e.addEventListener("keydown",t=>{"ArrowRight"===t.key?(t.preventDefault(),document.getElementById("next-page")?.focus()):"ArrowLeft"===t.key&&(t.preventDefault(),e.click())}),null===(t=document.getElementById("next-page"))||void 0===t||t.addEventListener("click",()=>{this.currentPage<this.totalPages&&(this.currentPage++,this.load())}),null===(t=document.getElementById("next-page"))||void 0===t||t.addEventListener("keydown",e=>{"ArrowLeft"===e.key?(e.preventDefault(),document.getElementById("prev-page")?.focus()):"ArrowRight"===e.key&&(e.preventDefault(),t.click())}),function(e){const t=document.getElementById("elementor-loop-content");if(!t||!("IntersectionObserver"in window))return void e();const n=new IntersectionObserver(t=>{t[0].isIntersecting&&(n.disconnect(),e())},{rootMargin:"200px"});n.observe(t)}(()=>this.load())}load(){return e(this,void 0,void 0,function*(){const e=document.getElementById("vg-events-skeleton"),t=document.getElementById("elementor-loop-content");e&&(e.style.display="block"),t&&(t.classList.remove("loaded"),t.setAttribute("aria-busy","true"));const o=document.querySelector("#post-type-filters .post-type-filter.active"),s=new URLSearchParams({post_types:this.config.post_types.join(","),selected_post_type:o&&o.dataset.postType||"",start_date:document.getElementById("start-date").value,end_date:document.getElementById("end-date").value,search:document.getElementById("search-bar").value,month:document.getElementById("month-filter").value,town:document.getElementById("town-filter").value,template_id:String(this.config.template_id),paged:String(this.currentPage),_wpnonce:this.config.nonce,prefetch_next:"1"}),i=`${this.config.rest_url}?${s.toString()}`,c=yield n(i);if(t&&(t.innerHTML=c.content||"",t.classList.add("loaded"),t.setAttribute("aria-busy","false")),e&&(e.style.display="none"),this.totalPages=c.total_pages||1,this.currentPage=c.current_page||1,function(e,t){const n=document.getElementById("page-info"),o=document.getElementById("prev-page"),s=document.getElementById("next-page");n&&(n.textContent=`${e} / ${t}`),o&&(o.disabled=1===e),s&&(s.disabled=e===t),r("vg-aria-announcer",`${e} of ${t}`)}(this.currentPage,this.totalPages),c.next_page){!function(e){a||(a=document.createElement("link"),a.rel="prefetch",document.head.appendChild(a)),a.href=e}(`${this.config.rest_url}?paged=${this.currentPage+1}`)}const d=document.getElementById("month-filter").value,l=document.getElementById("town-filter").value;let u=`${c.total_posts||0} events`;if(d&&(u+=` for ${d}`),l&&(u+=` in ${l}`),r("vg-aria-announcer",u),this.config.debug&&c.debug){const e=document.getElementById("vg-events-debug");e&&(e.classList.add("active"),e.textContent=JSON.stringify(c.debug,null,2))}})}}function c(){window.vgEvents&&new i(window.vgEvents)}return c(),c}();